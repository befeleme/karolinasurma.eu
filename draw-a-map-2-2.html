<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Draw a map! (2/2) &ndash; A blog</title>

    <!-- Meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Social -->
    <meta property="article:author" content="Karo" />
    <meta property="article:section" content="OpenStreetMap" />
    <meta property="article:published_time" content="2021-03-20" />

    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Draw a map! (2/2)"/>
    <meta property="og:description" content="In the first part you&#39;ve learned about a tool called uMap. For some use cases a static map is enough. OpenStreetMap is however very much alive and changes every second. You may want to reflect those changes in your map. Real time requests aren&#39;t feasible with current OSM state. If â€¦"/>
    <meta property="og:site_name" content="A blog" />
    <meta property="og:url" content="https://karolinasurma.eu/draw-a-map-2-2.html"/>

    <!-- Feed -->
    <link rel="alternate" type="application/atom+xml" href="https://karolinasurma.eu/feeds/all.atom.xml" title="A blog Atom Feed" />

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="https://karolinasurma.eu/theme/css/opensans.css">
    <link rel="stylesheet" type="text/css" href="https://karolinasurma.eu/theme/css/w3.css">
    <link rel="stylesheet" type="text/css" href="https://karolinasurma.eu/theme/css/style.css">
    <link rel="stylesheet" type="text/css" href="https://karolinasurma.eu/theme/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="https://karolinasurma.eu/theme/css/pygments-highlight-github.css">

    <!-- Icon -->
    <link rel="shortcut icon" type="image/x-icon" href="https://karolinasurma.eu/./images/extra/favicon.ico">

  </head>

  <body>
    <div class="w3-row w3-card w3-white">
      <header id="header">
        <a href="https://karolinasurma.eu/" id="header-logo" title="Home">KS</a>
        <nav id="header-menu">
          <ul>
            <li class="w3-bottombar w3-border-white w3-hover-border-green"><a href="/categories.html">Categories</a></li>
            <li class="w3-bottombar w3-border-white w3-hover-border-green"><a href="/archives.html">Archive</a></li>
          </ul>
        </nav>
      </header>
    </div>



    <br><br><br>

    <article>
      <header class="w3-container col-main">
        <h1>Draw a map! (2/2)</h1>
        <div class="post-info">
          <div class="w3-opacity w3-margin-right w3-margin-bottom" style="flex-grow: 1;">
            <span><time datetime="2021-03-20T14:00:00+01:00">Sat 20 March 2021</time> in <a href="https://karolinasurma.eu/category/openstreetmap.html" title="All articles in category OpenStreetMap">OpenStreetMap</a></span>
          </div>
          <div>
            <span class="w3-tag w3-light-grey w3-text-green w3-hover-green">
              <a href="https://karolinasurma.eu/tag/mapping.html" title="All articles with Mapping tag">#mapping</a>
            </span>
            <span class="w3-tag w3-light-grey w3-text-green w3-hover-green">
              <a href="https://karolinasurma.eu/tag/umap.html" title="All articles with Umap tag">#uMap</a>
            </span>
            <span class="w3-tag w3-light-grey w3-text-green w3-hover-green">
              <a href="https://karolinasurma.eu/tag/en.html" title="All articles with En tag">#EN</a>
            </span>
          </div>
        </div>
      </header>

      <br>


      <div class="col-main w3-container">
        <section id="content">
          <p>In the <a href="./draw-a-map-1.html">first part</a> you've learned about a tool called uMap. 
For some use cases a static map is enough.</p>
<p>OpenStreetMap is however very much alive and changes every second.
You may want to reflect those changes in your map.
Real time requests aren't feasible with current OSM state. 
If you try to send too many of them, you may end up with a ban on Overpass servers.</p>
<p>Let's say you'd like to update the map nightly, which shouldn't be too hard on Overpass.</p>
<h2>Where to for lunch?</h2>
<p>My goal was to display all restaurants where I can eat in the region I live.
I wanted to filter for places which serve <em>plant-based menu</em> and display them on the map.
This way I not only know where to go for lunch, but also have a visual clue when it comes to updating non-existent places. </p>
<p>Let's see how to proceed with such a map.</p>
<p>At this point you know:</p>
<ul>
<li>how to ask for the data you're interested in</li>
<li>how to take the data from Overpass and put them in the map</li>
</ul>
<p>What's the goal?</p>
<p>Automate the process and set it to ask for data periodically, every night.</p>
<h2>Git scraping for the rescue</h2>
<p>You need a machine to perform some actions in the middle of the night.
The actions contain:</p>
<ul>
<li>requesting the data</li>
<li>storing the data</li>
</ul>
<h3>Where to store data?</h3>
<p>For small data samples (like restaurants in your city), <a href="https://github.com/">GitHub</a> can be a place of choice.
Just remember, GitHub was not designed to be free database. 
It won't let you store too much data in a repository.</p>
<h3>How to request data?</h3>
<p>There is a technique called <a href="https://simonwillison.net/2020/Oct/9/git-scraping/">Git scraping</a> shown by <a href="https://honzajavorek.cz/">Honza Javorek</a> on one <a href="https://pyvo.cz/">Pyvo</a>. </p>
<p>GitHub provides a tool called GitHub Actions which you can set up to perform various tasks for you.
Like for example... calling an API request and, in case the response file is changed, commit it automatically to a repository.</p>
<blockquote>
<p><strong>Git note</strong></p>
<p>If you're reading this and struggle with terms like 'repository' or 'commit', consider learning about Git basics first, for example <a href="https://www.freecodecamp.org/news/learn-the-basics-of-git-in-under-10-minutes-da548267cc91/">here</a>.</p>
</blockquote>
<h4>How to get a valid URL to send requests?</h4>
<p>Once you've built an Overpass query that satisfies you, look for <strong>Export</strong> option in the menu.
Then find <strong>Query</strong> and click on <em>compact</em> in <strong>Convert to...</strong> option. A new pane with the query will open. 
Copy the displayed query and try it in another tab. 
It should provide JSON data - you're set.  </p>
<p>To make things as easy as they can be, let's use bash command <code>curl</code> to make a request. 
<code>curl</code> will take a URL to call as an argument, and the output will be directed to a file, like this:</p>
<p><code>curl 'url_to_request' &gt; my_data.json</code></p>
<p>The actual example is a bit longer, mainly because API parameters in Overpass are quite verbose.
Check my script <a href="https://github.com/befeleme/vegan_JMK/blob/main/run.sh">run.sh</a>. I call for 4 sets of data with 5-minute breaks in between.</p>
<p>The process of calling and storing takes place automatically. 
See my configuration file in <a href="https://github.com/befeleme/vegan_JMK/blob/main/.github/workflows/scrape.yml">scrape.yml</a>.
Let's ignore Python rows as they are not necessary for this project.
The configuration says that each day at 2.15 AM an Ubuntu machine copies the code from my repository, executes the <code>run.sh</code> script and in case the files have changed, commits them to repository as user <em>Automated</em>.  </p>
<p>So the script runs every night but it commits now and then - when someone changes the restaurant's data. 
The big benefit is I can track changes to the <a href="https://github.com/befeleme/vegan_JMK/commit/5cad11ed48baee9880c5b60d0464ccf19fedc46b">date</a>.</p>
<p>As a result there are several JSON files in <code>output</code> folder.
Let's connect them with the map!</p>
<h2>Point the map to remote data</h2>
<p>Pasting data to the map as it was shown in the previous post isn't the right way here.</p>
<p>I want to display different layers of data (100% plant-serving places, places with some options...- one layer per each JSON file from my repository).
For each layer I want to set different color and properties. 
This is achieved by setting <strong>Remote data</strong> in Layers.</p>
<p><img alt="layers" src="./images/umap-layers-overview.png">
<img alt="remote" src="./images/umap-layers-remote.png"></p>
<p>There is a field for URL with data. That's great. As it happens, we have an accessible remote storage of the data - we only need to paste the URL to <strong>raw</strong> data, so that uMap parses it correctly.
You'll get the raw data by clicking on the respective button.
<img alt="raw-data" src="./images/gh-raw-file.png"></p>
<p>Fill in the marked fields and click <strong>Save</strong>.</p>
<p><img alt="remote-data" src="./images/umap-remote.png"></p>
<p>One layer of data is imported and, what's more, it will be updated every time someone changes underlaying information.</p>
<h2>The result</h2>
<iframe width="100%" height="600px" frameborder="0" allowfullscreen src="//umap.openstreetmap.fr/en/map/vege-jmk_557579?scaleControl=false&miniMap=false&scrollWheelZoom=false&zoomControl=true&allowEdit=false&moreControl=true&searchControl=null&tilelayersControl=null&embedControl=null&datalayersControl=true&onLoadPanel=none&captionBar=false&datalayers=1584303%2C1584302%2C1584304%2C1581977%2C1581976%2C1581961%2C1581969#15/49.1991/16.6104"></iframe>

<p><a href="//umap.openstreetmap.fr/en/map/vege-jmk_557579">See full screen</a></p>
        </section>

        <br><br><br>

        <footer>
          <div class="adjust-width">
            <div id="author-block" class="w3-light-grey w3-border">
              <div id="author-info">
                <a href="mailto:w_oczekiwaniu[at]interia.pl"><img class="avatar" src="./images/extra/karo.jpg" onerror="this.src='theme/images/avatar.png'" alt="Avatar"></a>
                <div style="margin-left: 20px;">
                  <a href="mailto:w_oczekiwaniu[at]interia.pl"><span id="author-name" class="w3-hover-text-dark-grey">Karo</span></a>
                  <p id="author-story">Hi there! Iâ€™m Karo. Whenever not computering, I read yet another book or hike through South Moravia.</p>
                </div>
              </div>
            </div>
          </div>

          <br><br><br>




        </footer>
      </div>
    </article>


    <footer id="footer">
      <div id="footer-copyright" class="w3-center w3-small w3-text-grey w3-padding-48">
        <span>
          &copy;
          2021          Karo
 | <a href="https://karolinasurma.eu/feeds/all.atom.xml">Atom feed <i class="fa fa-rss" aria-hidden="true"></i></a>        </span>
      </div>
    </footer>

  </body>
</html>